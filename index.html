<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Assistant TDAH</title>
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #F4A460;
            --secondary: #8FB886;
            --accent: #FFD700;
            --dark: #5C4033;
            --light: #FFF9E6;
            --success: #8FB886;
            --warning: #F4A460;
            --info: #87CEEB;
            --shadow: rgba(0, 0, 0, 0.1);
        }

        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #87CEEB 0%, #FFE5B4 50%, #FFD700 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--dark);
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 2%),
                radial-gradient(circle at 60% 70%, rgba(255, 255, 255, 0.2) 0%, transparent 2%),
                radial-gradient(circle at 80% 20%, rgba(255, 255, 255, 0.3) 0%, transparent 1.5%),
                radial-gradient(circle at 40% 80%, rgba(255, 255, 255, 0.2) 0%, transparent 1.5%),
                radial-gradient(circle at 90% 60%, rgba(255, 255, 255, 0.25) 0%, transparent 2%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            animation: slideDown 0.5s ease-out;
            background: rgba(255, 255, 255, 0.9);
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 215, 0, 0.3);
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }

        .logo-img {
            width: 120px;
            height: auto;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        h1 {
            font-size: 3rem;
            color: var(--primary);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            margin: 0;
            font-weight: 700;
        }

        .subtitle {
            color: var(--secondary);
            font-size: 1.2rem;
            font-weight: 500;
            margin-top: 10px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            animation: slideUp 0.5s ease-out 0.2s both;
        }

        .tab-btn {
            background: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px var(--shadow);
            font-family: 'Poppins', sans-serif;
            color: var(--dark);
        }

        .tab-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            transform: scale(1.05);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease-out;
        }

        .tab-content.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.08);
            transition: transform 0.3s ease;
            border: 2px solid rgba(244, 164, 96, 0.2);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.12);
        }

        .card-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .emoji {
            font-size: 1.8rem;
        }

        input, textarea, select {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            margin-bottom: 15px;
            transition: border-color 0.3s ease;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: var(--secondary);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        button {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .task-list {
            display: grid;
            gap: 15px;
        }

        .task-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
            animation: slideIn 0.3s ease-out;
        }

        .task-item:hover {
            transform: translateX(10px);
        }

        .task-item.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .task-checkbox {
            width: 24px;
            height: 24px;
            cursor: pointer;
        }

        .task-content {
            flex: 1;
        }

        .task-priority {
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .priority-urgent {
            background: var(--primary);
            color: white;
        }

        .priority-important {
            background: var(--warning);
            color: var(--dark);
        }

        .priority-normal {
            background: var(--success);
            color: white;
        }

        .priority-later {
            background: var(--info);
            color: white;
        }

        .delete-btn {
            background: transparent;
            color: var(--primary);
            padding: 5px 10px;
            font-size: 1.2rem;
        }

        .emotion-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .emotion-card {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--info) 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .emotion-card:hover {
            transform: scale(1.1) rotate(2deg);
        }

        .emotion-card.selected {
            background: linear-gradient(135deg, var(--primary) 0%, var(--warning) 100%);
            transform: scale(1.05);
        }

        .emotion-icon {
            font-size: 3rem;
            margin-bottom: 10px;
        }

        .problem-steps {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .step {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid var(--secondary);
        }

        .step-number {
            background: var(--secondary);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            margin-right: 10px;
        }

        .tips-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .tip-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px var(--shadow);
        }

        .tip-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .result-box {
            background: #e8f5e9;
            border: 2px solid var(--success);
            padding: 20px;
            border-radius: 15px;
            margin-top: 20px;
            animation: fadeIn 0.5s ease-out;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success) 0%, var(--secondary) 100%);
            transition: width 0.5s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }
            
            .grid-2 {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
        }

        .timer-display {
            font-size: 3rem;
            font-family: 'Space Mono', monospace;
            text-align: center;
            color: var(--primary);
            margin: 20px 0;
            font-weight: 700;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .energy-meter {
            text-align: center;
            margin: 20px 0;
        }

        .energy-level {
            font-size: 4rem;
            margin: 10px 0;
        }

        .period-btn {
            background: white;
            border: 2px solid var(--secondary);
            color: var(--dark);
            padding: 10px 20px;
            border-radius: 25px;
            margin: 0 5px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .period-btn:hover {
            transform: translateY(-2px);
        }

        .period-btn.active {
            background: var(--secondary);
            color: white;
        }

        .milestone-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border-left: 4px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .milestone-date {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div style="text-align: right; margin-bottom: 10px;">
                <a href="accueil.html" style="display: inline-block; padding: 10px 20px; background: #FF6B6B; color: white; text-decoration: none; border-radius: 25px; font-weight: 600; transition: all 0.3s; font-size: 0.9rem;">
                    üè† Retour √† l'accueil
                </a>
            </div>
            <div class="logo-container">
                <img src="logo-petit-prince.webp" alt="Le Petit Prince" class="logo-img">
                <h1>Mon Assistant TDAH</h1>
            </div>
            <p class="subtitle">Du SESSAD Petit Prince</p>
        </header>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('tasks')">üìã Mes T√¢ches</button>
            <button class="tab-btn" onclick="switchTab('sequential')">üìã Cr√©er un S√©quentiel</button>
            <button class="tab-btn" onclick="switchTab('stats')">üìä Mes Statistiques</button>
            <button class="tab-btn" onclick="switchTab('problem')">üß© R√©soudre un Probl√®me</button>
            <button class="tab-btn" onclick="switchTab('situations')">üé™ Situations du quotidien</button>
            <button class="tab-btn" onclick="switchTab('tips')">üí° Astuces TDAH</button>
        </div>

        <!-- T√ÇCHES -->
        <div id="tasks" class="tab-content active">
            <div class="grid-2">
                <div class="card">
                    <h2 class="card-title"><span class="emoji">‚ûï</span>Ajouter une t√¢che</h2>
                    <input type="text" id="taskInput" placeholder="Quelle est la t√¢che ?" />
                    <select id="prioritySelect">
                        <option value="urgent">üî¥ Urgent (√† faire maintenant)</option>
                        <option value="important">üü° Important (aujourd'hui)</option>
                        <option value="normal" selected>üü¢ Normal (cette semaine)</option>
                        <option value="later">üîµ Plus tard (quand possible)</option>
                    </select>
                    <button onclick="addTask()">Ajouter la t√¢che</button>
                </div>

                <div class="card">
                    <h2 class="card-title"><span class="emoji">üìä</span>Mon progr√®s</h2>
                    <div class="energy-meter">
                        <p><strong>T√¢ches compl√©t√©es aujourd'hui</strong></p>
                        <div class="energy-level" id="completedCount">0</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressBar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title"><span class="emoji">üìù</span>Ma liste de t√¢ches</h2>
                <div class="task-list" id="taskList"></div>
            </div>
        </div>

        <!-- √âMOTIONS -->
        <div id="emotions" class="tab-content">
            <div class="card">
                <h2 class="card-title"><span class="emoji">üé≠</span>Comment je me sens ?</h2>
                <p>Clique sur l'√©motion qui te correspond le mieux en ce moment :</p>
                <div class="emotion-grid">
                    <div class="emotion-card" onclick="selectEmotion('joyeux', this)">
                        <div class="emotion-icon">üòä</div>
                        <div>Joyeux</div>
                    </div>
                    <div class="emotion-card" onclick="selectEmotion('calme', this)">
                        <div class="emotion-icon">üòå</div>
                        <div>Calme</div>
                    </div>
                    <div class="emotion-card" onclick="selectEmotion('anxieux', this)">
                        <div class="emotion-icon">üò∞</div>
                        <div>Anxieux</div>
                    </div>
                    <div class="emotion-card" onclick="selectEmotion('frustr√©', this)">
                        <div class="emotion-icon">üò§</div>
                        <div>Frustr√©</div>
                    </div>
                    <div class="emotion-card" onclick="selectEmotion('triste', this)">
                        <div class="emotion-icon">üò¢</div>
                        <div>Triste</div>
                    </div>
                    <div class="emotion-card" onclick="selectEmotion('d√©bord√©', this)">
                        <div class="emotion-icon">ü§Ø</div>
                        <div>D√©bord√©</div>
                    </div>
                    <div class="emotion-card" onclick="selectEmotion('excit√©', this)">
                        <div class="emotion-icon">ü§©</div>
                        <div>Excit√©</div>
                    </div>
                    <div class="emotion-card" onclick="selectEmotion('fatigu√©', this)">
                        <div class="emotion-icon">üò¥</div>
                        <div>Fatigu√©</div>
                    </div>
                </div>
                <div id="emotionResult"></div>
            </div>

            <div class="card">
                <h2 class="card-title"><span class="emoji">‚úçÔ∏è</span>Journal √©motionnel</h2>
                <textarea id="emotionJournal" placeholder="D√©cris ce qui se passe dans ta t√™te en ce moment... Qu'est-ce qui a d√©clench√© cette √©motion ?"></textarea>
                <button onclick="saveEmotionEntry()">Enregistrer mon ressenti</button>
                <div id="journalEntries"></div>
            </div>
        </div>

        <!-- CR√âATION DE S√âQUENTIEL -->
        <div id="sequential" class="tab-content">
            <div class="card">
                <h2 class="card-title"><span class="emoji">üìã</span>Cr√©er un S√©quentiel Visuel</h2>
                <p style="margin-bottom: 20px;">Cr√©e un s√©quentiel visuel √©tape par √©tape avec des images et/ou du texte. Parfait pour structurer une routine, une t√¢che complexe ou une s√©quence d'actions !</p>
                
                <!-- Titre du s√©quentiel -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #FF6B6B; margin-bottom: 15px;">üìù Titre de ton s√©quentiel :</h3>
                    <input type="text" id="sequentialTitle" placeholder="Ex: Ma routine du matin, Faire mes devoirs, Pr√©parer mon sac..." style="width: 100%; padding: 15px; border: 2px solid #FF6B6B; border-radius: 10px; font-size: 1.1rem; font-family: 'Poppins', sans-serif; font-weight: 600;">
                </div>

                <!-- Liste des √©tapes -->
                <div style="margin-bottom: 30px;">
                    <h3 style="color: #FF6B6B; margin-bottom: 15px;">üìå √âtapes de ton s√©quentiel :</h3>
                    <div id="sequentialSteps" style="display: flex; flex-direction: column; gap: 20px;">
                        <!-- Les √©tapes seront ajout√©es ici dynamiquement -->
                    </div>
                </div>

                <!-- Bouton ajouter une √©tape -->
                <div style="display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 30px;">
                    <button onclick="addSequentialStep()" style="flex: 1; min-width: 200px; padding: 15px; background: #51CF66; color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: 'Poppins', sans-serif;">
                        ‚ûï Ajouter une √©tape
                    </button>
                    <button onclick="generateSequentialPDF()" style="flex: 1; min-width: 200px; padding: 15px; background: #4ECDC4; color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: 'Poppins', sans-serif;">
                        üìÑ G√©n√©rer le PDF
                    </button>
                    <button onclick="clearSequential()" style="flex: 1; min-width: 200px; padding: 15px; background: #FF6B6B; color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: 'Poppins', sans-serif;">
                        üóëÔ∏è Tout effacer
                    </button>
                </div>

                <!-- Message d'info -->
                <div id="sequentialMessage" style="display: none; margin-top: 15px; padding: 15px; background: #D4EDDA; border: 2px solid #28A745; border-radius: 10px; color: #155724; font-weight: 600; text-align: center;"></div>
            </div>

            <!-- Carte d'aide -->
            <div class="card" style="background: #FFF3E0; border: 2px solid #FF6B6B;">
                <h3 style="color: #FF6B6B; margin-bottom: 15px;">üí° Comment cr√©er ton s√©quentiel ?</h3>
                <ol style="line-height: 2; margin-left: 20px;">
                    <li><strong>Donne un titre</strong> √† ton s√©quentiel (ex: "Ma routine du matin")</li>
                    <li><strong>Ajoute des √©tapes</strong> une par une en cliquant sur "Ajouter une √©tape"</li>
                    <li><strong>Pour chaque √©tape :</strong>
                        <ul style="margin-top: 10px; margin-left: 20px;">
                            <li>√âcris le texte de l'√©tape (ex: "Me brosser les dents")</li>
                            <li>Optionnel : Ajoute une image (photo, pictogramme, dessin)</li>
                        </ul>
                    </li>
                    <li><strong>R√©organise</strong> les √©tapes avec les fl√®ches ‚Üë ‚Üì</li>
                    <li><strong>G√©n√®re le PDF</strong> pour l'imprimer et l'afficher !</li>
                </ol>
                <p style="margin-top: 15px; font-style: italic; color: #666;">üí° Astuce : Les s√©quentiels visuels aident √† d√©composer les t√¢ches complexes et √† ne rien oublier !</p>
            </div>
        </div>

        <!-- STATISTIQUES -->
        <div id="stats" class="tab-content">
            <div class="card">
                <h2 class="card-title"><span class="emoji">üìä</span>Mes Statistiques</h2>
                
                <!-- S√©lecteur de p√©riode -->
                <div style="text-align: center; margin-bottom: 30px;">
                    <button onclick="changeStatsPeriod('today')" id="btn-today" class="period-btn active">Aujourd'hui</button>
                    <button onclick="changeStatsPeriod('week')" id="btn-week" class="period-btn">7 derniers jours</button>
                    <button onclick="changeStatsPeriod('month')" id="btn-month" class="period-btn">30 derniers jours</button>
                </div>

                <!-- Graphique des √©motions -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">üìà √âvolution de mes √©motions</h3>
                    <canvas id="emotionsChart" style="max-height: 300px;"></canvas>
                    <div id="emotionsChartLegend" style="margin-top: 15px; text-align: center;"></div>
                </div>

                <!-- Graphique des t√¢ches -->
                <div style="background: white; padding: 25px; border-radius: 15px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                    <h3 style="color: var(--secondary); margin-bottom: 20px;">‚úÖ Progression des t√¢ches</h3>
                    <canvas id="tasksChart" style="max-height: 300px;"></canvas>
                </div>

                <!-- Statistiques r√©sum√©es -->
                <div class="grid-2">
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 15px; color: white; text-align: center;">
                        <div style="font-size: 3rem; font-weight: 700;" id="totalTasksCompleted">0</div>
                        <div style="font-size: 1.2rem; margin-top: 10px;">T√¢ches compl√©t√©es</div>
                        <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;" id="periodLabel">cette p√©riode</div>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); padding: 25px; border-radius: 15px; color: white; text-align: center;">
                        <div style="font-size: 3rem; font-weight: 700;" id="emotionMostFrequent">-</div>
                        <div style="font-size: 1.2rem; margin-top: 10px;">√âmotion dominante</div>
                        <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 5px;">cette p√©riode</div>
                    </div>
                </div>

                <!-- Points d'√©tape -->
                <div style="background: #f8f9fa; padding: 25px; border-radius: 15px; margin-top: 25px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">üéØ Mes points d'√©tape</h3>
                    <div id="milestonesList"></div>
                    <button onclick="addMilestone()" style="margin-top: 15px;">‚ûï Ajouter un point d'√©tape</button>
                </div>
            </div>
        </div>

        <!-- R√âSOLUTION DE PROBL√àME -->
        <div id="problem" class="tab-content">
            <div class="card">
                <h2 class="card-title"><span class="emoji">üéØ</span>Analyse fonctionnelle du probl√®me</h2>
                <p style="margin-bottom: 20px;">Cette m√©thode t'aide √† comprendre POURQUOI le comportement/probl√®me existe et comment le changer.</p>
                
                <div class="problem-steps">
                    <div class="step">
                        <span class="step-number">1</span>
                        <strong>Situation d√©clenchante (AVANT)</strong>
                        <p style="font-size: 0.9rem; color: #666; margin: 5px 0;">Qu'est-ce qui se passe juste avant le probl√®me ? O√π es-tu ? Que fais-tu ? Avec qui ?</p>
                        <textarea id="problemBefore" placeholder="Ex: Je suis seul dans ma chambre, je dois √©tudier, il est 14h apr√®s le d√©jeuner..."></textarea>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">2</span>
                        <strong>Le comportement/probl√®me (PENDANT)</strong>
                        <p style="font-size: 0.9rem; color: #666; margin: 5px 0;">D√©cris pr√©cis√©ment ce que tu fais. Sois factuel et observable.</p>
                        <textarea id="problemBehavior" placeholder="Ex: Je scroll sur mon t√©l√©phone pendant 2h au lieu d'√©tudier..."></textarea>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">3</span>
                        <strong>Cons√©quences imm√©diates (APR√àS)</strong>
                        <p style="font-size: 0.9rem; color: #666; margin: 5px 0;">Qu'est-ce que ce comportement t'apporte imm√©diatement ? (m√™me si c'est n√©gatif √† long terme)</p>
                        <textarea id="problemAfter" placeholder="Ex: Je me sens moins stress√©, je suis distrait de mon anxi√©t√©, j'√©vite la difficult√©..."></textarea>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">4</span>
                        <strong>Fonction du comportement</strong>
                        <p style="font-size: 0.9rem; color: #666; margin: 5px 0;">Quel besoin satisfait ce comportement ?</p>
                        <select id="problemFunction">
                            <option value="">-- Choisis la fonction principale --</option>
                            <option value="escape">√âviter/√âchapper (stress, ennui, difficult√©, √©motions n√©gatives)</option>
                            <option value="attention">Obtenir de l'attention (m√™me n√©gative)</option>
                            <option value="tangible">Obtenir quelque chose de concret (objet, activit√© plaisante, stimulation)</option>
                            <option value="sensory">Stimulation sensorielle (besoin de bouger, de stimulation)</option>
                        </select>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">5</span>
                        <strong>Comportement alternatif</strong>
                        <p style="font-size: 0.9rem; color: #666; margin: 5px 0;">Quel comportement pourrait satisfaire le M√äME besoin de fa√ßon plus adapt√©e ?</p>
                        <textarea id="problemAlternative" placeholder="Ex: Si je cherche √† √©viter le stress -> je peux faire 5 min de respiration avant d'√©tudier, d√©couper la t√¢che en 10 min..."></textarea>
                    </div>
                    
                    <div class="step">
                        <span class="step-number">6</span>
                        <strong>Premi√®re action concr√®te</strong>
                        <p style="font-size: 0.9rem; color: #666; margin: 5px 0;">La TOUTE premi√®re micro-action pour mettre en place l'alternative</p>
                        <input type="text" id="problemFirstStep" placeholder="Ex: Mettre mon t√©l√©phone dans une autre pi√®ce avant de commencer" />
                    </div>
                    
                    <button onclick="solveProblem()">Analyser et cr√©er mon plan</button>
                </div>
                <div id="problemResult"></div>
            </div>
        </div>

        <!-- FOCUS TIMER -->
        <div id="focus" class="tab-content">
            <div class="card">
                <h2 class="card-title"><span class="emoji">‚è±Ô∏è</span>Pomodoro Focus Timer</h2>
                <p style="text-align: center; margin-bottom: 20px;">Travaille par sessions courtes pour maintenir ta concentration</p>
                <div class="timer-display" id="timerDisplay">25:00</div>
                <div class="timer-controls">
                    <button onclick="startTimer()">‚ñ∂Ô∏è D√©marrer</button>
                    <button onclick="pauseTimer()">‚è∏Ô∏è Pause</button>
                    <button onclick="resetTimer()">üîÑ Reset</button>
                </div>
                <div style="margin-top: 20px; text-align: center;">
                    <select id="timerDuration" onchange="changeTimerDuration()">
                        <option value="15">15 minutes</option>
                        <option value="25" selected>25 minutes (Pomodoro)</option>
                        <option value="45">45 minutes</option>
                    </select>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title"><span class="emoji">‚ö°</span>Mon niveau d'√©nergie</h2>
                <p style="text-align: center;">Adapte tes t√¢ches √† ton √©nergie du moment</p>
                <div class="emotion-grid">
                    <div class="emotion-card" onclick="suggestByEnergy('high')">
                        <div class="emotion-icon">üöÄ</div>
                        <div>Haute √©nergie</div>
                    </div>
                    <div class="emotion-card" onclick="suggestByEnergy('medium')">
                        <div class="emotion-icon">‚ö°</div>
                        <div>√ânergie moyenne</div>
                    </div>
                    <div class="emotion-card" onclick="suggestByEnergy('low')">
                        <div class="emotion-icon">üîã</div>
                        <div>Basse √©nergie</div>
                    </div>
                </div>
                <div id="energySuggestions"></div>
            </div>
        </div>

        <!-- SITUATIONS DU QUOTIDIEN -->
        <div id="situations" class="tab-content">
            <div class="card">
                <h2 class="card-title"><span class="emoji">üé™</span>Recommandations par situation</h2>
                <p style="margin-bottom: 20px;">S√©lectionne la situation que tu vis en ce moment et d√©couvre des strat√©gies adapt√©es :</p>
                
                <div class="emotion-grid">
                    <div class="emotion-card" onclick="showSituation('procrastination')">
                        <div class="emotion-icon">‚è∞</div>
                        <div>Procrastination</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('submerg√©')">
                        <div class="emotion-icon">üåä</div>
                        <div>Je suis submerg√©</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('distraction')">
                        <div class="emotion-icon">üéØ</div>
                        <div>Impossible de me concentrer</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('hyperfocus')">
                        <div class="emotion-icon">üî•</div>
                        <div>Hyperfocus</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('transitions')">
                        <div class="emotion-icon">üîÑ</div>
                        <div>Difficult√©s de transition</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('matin')">
                        <div class="emotion-icon">üåÖ</div>
                        <div>D√©marrage difficile</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('soir')">
                        <div class="emotion-icon">üåô</div>
                        <div>Coucher difficile</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('social')">
                        <div class="emotion-icon">üë•</div>
                        <div>Situations sociales</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('decisions')">
                        <div class="emotion-icon">ü§î</div>
                        <div>Paralysie d√©cisionnelle</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('rejection')">
                        <div class="emotion-icon">üíî</div>
                        <div>Sensibilit√© au rejet</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('impulsivit√©')">
                        <div class="emotion-icon">‚ö°</div>
                        <div>Impulsivit√©</div>
                    </div>
                    <div class="emotion-card" onclick="showSituation('ennui')">
                        <div class="emotion-icon">üòë</div>
                        <div>Ennui intense</div>
                    </div>
                </div>
                
                <div id="situationResult"></div>
            </div>
        </div>

        <!-- ASTUCES -->
        <div id="tips" class="tab-content">
            <div class="tips-container">
                <div class="tip-card">
                    <div class="tip-icon">üß©</div>
                    <h3>Diviser pour r√©gner</h3>
                    <p>D√©coupe chaque grande t√¢che en mini-√©tapes de 5-10 minutes. C'est beaucoup moins intimidant et tu auras plus de victoires √† c√©l√©brer !</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">‚è∞</div>
                    <h3>Timer ton ami</h3>
                    <p>Utilise des timers pour TOUT : temps de travail, pause, transition. √áa aide ton cerveau √† comprendre les limites temporelles.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üé®</div>
                    <h3>Rends-le visuel</h3>
                    <p>Post-its color√©s, tableaux, listes avec dessins... Plus c'est visuel, plus ton cerveau TDAH l'adore !</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üéµ</div>
                    <h3>Musique de focus</h3>
                    <p>Trouve TA musique de concentration (lofi, classique, bruits blancs...). Cr√©e une playlist d√©di√©e au travail.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üö∂</div>
                    <h3>Bouge ton corps</h3>
                    <p>Besoin de bouger ? C'est normal ! Int√®gre du mouvement : marche, √©tirements, fidgets. Ton corps a besoin d'√©vacuer.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üì±</div>
                    <h3>Limite les distractions</h3>
                    <p>Phone en mode avion, notifications OFF, une seule fen√™tre ouverte. Ton environnement doit √™tre ton alli√©.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üéÅ</div>
                    <h3>Syst√®me de r√©compenses</h3>
                    <p>Apr√®s chaque t√¢che, offre-toi un petit plaisir : snack, vid√©o courte, jeu 5 min. Ton cerveau adore la dopamine !</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üí§</div>
                    <h3>Sommeil sacr√©</h3>
                    <p>Un cerveau TDAH fatigu√© = mode chaos activ√©. Priorise ton sommeil, c'est ton super-pouvoir de r√©g√©n√©ration.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üóìÔ∏è</div>
                    <h3>Routine du matin</h3>
                    <p>Cr√©e une routine matinale simple et toujours identique. √áa aide ton cerveau √† d√©marrer en douceur.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">ü§ù</div>
                    <h3>Body double</h3>
                    <p>Travaille √† c√¥t√© de quelqu'un (m√™me en vid√©o). La pr√©sence d'autrui aide ton cerveau √† rester concentr√©.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üìù</div>
                    <h3>Brain dump quotidien</h3>
                    <p>Chaque matin, vide toutes tes pens√©es sur papier pendant 5 min. √áa lib√®re de l'espace mental.</p>
                </div>
                <div class="tip-card">
                    <div class="tip-icon">üéØ</div>
                    <h3>Une chose √† la fois</h3>
                    <p>Le multit√¢che est l'ennemi du TDAH. Focus sur UNE seule chose jusqu'au bout, puis passe √† la suivante.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // GESTION DES ONGLETS
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // Activer le bouton cliqu√©
            const clickedButton = Array.from(document.querySelectorAll('.tab-btn')).find(btn => 
                btn.textContent.includes(tabName === 'tasks' ? 'T√¢ches' : 
                                        tabName === 'emotions' ? '√âmotions' :
                                        tabName === 'stats' ? 'Statistiques' :
                                        tabName === 'problem' ? 'Probl√®me' :
                                        tabName === 'focus' ? 'Focus Timer' :
                                        tabName === 'situations' ? 'Situations' : 'Astuces')
            );
            if (clickedButton) clickedButton.classList.add('active');
            
            // Charger les donn√©es pour cet onglet
            if (tabName === 'tasks') loadTasks();
            if (tabName === 'emotions') loadJournalEntries();
            if (tabName === 'stats') {
                updateStatsCharts();
                loadMilestones();
            }
        }

        // GESTION DES T√ÇCHES
        let tasks = JSON.parse(localStorage.getItem('tasks')) || [];
        
        function addTask() {
            const taskInput = document.getElementById('taskInput');
            const priority = document.getElementById('prioritySelect').value;
            
            if (taskInput.value.trim() === '') {
                alert('Entre une t√¢che !');
                return;
            }
            
            const task = {
                id: Date.now(),
                text: taskInput.value,
                priority: priority,
                completed: false,
                date: new Date().toLocaleDateString('fr-FR')
            };
            
            tasks.push(task);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            taskInput.value = '';
            loadTasks();
        }
        
        function loadTasks() {
            const taskList = document.getElementById('taskList');
            taskList.innerHTML = '';
            
            if (tasks.length === 0) {
                taskList.innerHTML = '<p style="text-align: center; color: #999;">Aucune t√¢che pour le moment. Ajoute-en une ! üéØ</p>';
                return;
            }
            
            // Trier par priorit√©
            const priorityOrder = { urgent: 0, important: 1, normal: 2, later: 3 };
            tasks.sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority]);
            
            tasks.forEach(task => {
                const taskItem = document.createElement('div');
                taskItem.className = `task-item ${task.completed ? 'completed' : ''}`;
                taskItem.innerHTML = `
                    <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} 
                           onchange="toggleTask(${task.id})">
                    <div class="task-content">
                        <strong>${task.text}</strong>
                        <div style="font-size: 0.9rem; color: #666; margin-top: 5px;">${task.date}</div>
                    </div>
                    <span class="task-priority priority-${task.priority}">
                        ${task.priority === 'urgent' ? 'üî¥ Urgent' : 
                          task.priority === 'important' ? 'üü° Important' : 
                          task.priority === 'normal' ? 'üü¢ Normal' : 'üîµ Plus tard'}
                    </span>
                    <button class="delete-btn" onclick="deleteTask(${task.id})">üóëÔ∏è</button>
                `;
                taskList.appendChild(taskItem);
            });
            
            updateProgress();
        }
        
        function toggleTask(id) {
            const task = tasks.find(t => t.id === id);
            task.completed = !task.completed;
            localStorage.setItem('tasks', JSON.stringify(tasks));
            loadTasks();
        }
        
        function deleteTask(id) {
            tasks = tasks.filter(t => t.id !== id);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            loadTasks();
        }
        
        function updateProgress() {
            const completed = tasks.filter(t => t.completed).length;
            const total = tasks.length;
            const percentage = total > 0 ? (completed / total) * 100 : 0;
            
            document.getElementById('completedCount').textContent = completed;
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        // GESTION DES √âMOTIONS
        let selectedEmotion = '';
        
        function selectEmotion(emotion, element) {
            selectedEmotion = emotion;
            document.querySelectorAll('.emotion-card').forEach(card => {
                card.classList.remove('selected');
            });
            element.classList.add('selected');
            
            const emotionData = {
                joyeux: {
                    suggestion: 'Super ! Profite de cette √©nergie positive pour attaquer des t√¢ches que tu repoussais. C\'est le moment id√©al ! üåü',
                    besoins: [
                        '‚ú® Besoin de partager ta joie',
                        'üéØ Besoin d\'utiliser cette √©nergie de fa√ßon productive',
                        'üéâ Besoin de c√©l√©brer tes r√©ussites',
                        'üå± Besoin de cultiver ce moment positif'
                    ],
                    actions: [
                        'Lance-toi dans un projet qui te motive',
                        'Partage ta joie avec quelqu\'un',
                        'Note ce qui t\'a rendu joyeux (pour y revenir plus tard)',
                        'Utilise cette √©nergie pour les t√¢ches difficiles'
                    ]
                },
                calme: {
                    suggestion: 'Excellent √©tat pour r√©fl√©chir et planifier. Prends le temps d\'organiser ta journ√©e ou de faire des t√¢ches qui demandent de la concentration. üßò',
                    besoins: [
                        'üßò Besoin de pr√©server ce calme int√©rieur',
                        'üéØ Besoin de clart√© mentale',
                        'üìã Besoin d\'organiser tes pens√©es',
                        'üåø Besoin de t√¢ches qui demandent de la r√©flexion'
                    ],
                    actions: [
                        'Fais ta planification de la semaine',
                        'Attaque les t√¢ches qui demandent de la concentration',
                        'M√©dite ou fais des exercices de respiration',
                        '√âcris dans ton journal pour clarifier tes id√©es'
                    ]
                },
                anxieux: {
                    suggestion: 'Respire profond√©ment. Fais une pause, sors marcher 5 minutes, ou fais une activit√© qui t\'apaise. L\'anxi√©t√© passera. üå¨Ô∏è',
                    besoins: [
                        'üõ°Ô∏è Besoin de s√©curit√© et de r√©assurance',
                        'üå¨Ô∏è Besoin de calmer ton syst√®me nerveux',
                        'üéØ Besoin de reprendre le contr√¥le',
                        'üí™ Besoin de te sentir capable'
                    ],
                    actions: [
                        'Respiration 4-7-8 (inspire 4s, retiens 7s, expire 8s)',
                        'Nomme 5 choses que tu vois, 4 que tu touches, 3 que tu entends',
                        '√âcris ce qui t\'angoisse pour le sortir de ta t√™te',
                        'Fais une micro-t√¢che facile pour retrouver un sentiment de contr√¥le'
                    ]
                },
                frustr√©: {
                    suggestion: 'C\'est ok d\'√™tre frustr√©. Prends une pause active : bouge, √©coute de la musique √©nergique, ou √©vacue en √©crivant ce qui te frustre. üí™',
                    besoins: [
                        'üí® Besoin d\'√©vacuer cette √©nergie bloqu√©e',
                        'üéØ Besoin de r√©soudre ce qui bloque',
                        'üëÇ Besoin d\'√™tre entendu et compris',
                        'üí™ Besoin de retrouver ton pouvoir d\'action'
                    ],
                    actions: [
                        'Fais 10 squats ou sors marcher rapidement',
                        '√âcris rageusement ce qui te frustre (puis d√©chire la feuille)',
                        'Mets de la musique √©nergique et danse',
                        'Identifie UNE chose concr√®te que tu peux changer'
                    ]
                },
                triste: {
                    suggestion: 'Sois doux avec toi-m√™me. Fais des choses simples et r√©confortantes. Pas besoin d\'√™tre productif aujourd\'hui si ce n\'est pas le bon moment. üåà',
                    besoins: [
                        'ü§ó Besoin de r√©confort et de douceur',
                        'üò¢ Besoin d\'exprimer ta tristesse',
                        'ü´Ç Besoin de connexion humaine',
                        'üõå Besoin de prendre soin de toi'
                    ],
                    actions: [
                        'Appelle ou √©cris √† quelqu\'un de confiance',
                        'Fais quelque chose de r√©confortant (couverture, th√©, musique douce)',
                        'Autorise-toi √† pleurer si tu en as besoin',
                        'Ne force rien aujourd\'hui, repose-toi'
                    ]
                },
                d√©bord√©: {
                    suggestion: 'Stop ! Fais une liste de TOUT ce qui te stresse. Puis choisis UNE SEULE mini-t√¢che √† faire maintenant. Le reste peut attendre. üõë',
                    besoins: [
                        'üõë Besoin d\'arr√™ter et de faire une pause',
                        'üìù Besoin d\'organiser le chaos mental',
                        'üéØ Besoin de simplifier et prioriser',
                        'üí™ Besoin de retrouver un sentiment de contr√¥le'
                    ],
                    actions: [
                        'Brain dump : √©cris TOUT sur papier pendant 5 min',
                        'Respire 10 fois profond√©ment',
                        'Choisis UNE SEULE t√¢che mini √† faire maintenant',
                        'Dis NON ou demande de l\'aide pour le reste'
                    ]
                },
                excit√©: {
                    suggestion: 'Canalise cette √©nergie ! C\'est parfait pour faire avancer des projets cr√©atifs ou des t√¢ches dynamiques. Attention √† ne pas te disperser ! ‚ö°',
                    besoins: [
                        '‚ö° Besoin de canaliser cette √©nergie',
                        'üé® Besoin de cr√©er et d\'explorer',
                        'üéØ Besoin de focus pour ne pas te disperser',
                        'üöÄ Besoin d\'action et de mouvement'
                    ],
                    actions: [
                        'Choisis UN projet et mets un timer de 25 min',
                        'Fais une liste rapide pour capturer toutes tes id√©es',
                        'Lance-toi dans quelque chose de cr√©atif',
                        'Bouge ton corps : danse, marche rapide, sport'
                    ]
                },
                fatigu√©: {
                    suggestion: 'Ton corps te parle. Soit tu te reposes, soit tu fais des mini-t√¢ches faciles. Ne force pas. Le repos n\'est pas de la paresse. üò¥',
                    besoins: [
                        'üò¥ Besoin de repos et de r√©cup√©ration',
                        'üîã Besoin de recharger ton √©nergie',
                        'üí§ Besoin de respecter tes limites',
                        'üåô Besoin de sommeil de qualit√©'
                    ],
                    actions: [
                        'Fais une micro-sieste de 20 min si possible',
                        'Hydrate-toi et mange quelque chose de nourrissant',
                        'Ne fais que des t√¢ches automatiques et faciles',
                        'Planifie un vrai temps de repos ce soir'
                    ]
                }
            };
            
            const data = emotionData[emotion];
            
            const resultDiv = document.getElementById('emotionResult');
            resultDiv.innerHTML = `
                <div class="result-box">
                    <h3>üí° Suggestion personnalis√©e</h3>
                    <p style="font-size: 1.1rem; margin-bottom: 20px;">${data.suggestion}</p>
                    
                    <div style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); padding: 20px; border-radius: 10px; margin: 15px 0;">
                        <h4 style="margin-bottom: 15px;">üéØ Besoins identifi√©s :</h4>
                        <ul style="list-style: none; padding: 0;">
                            ${data.besoins.map(besoin => `
                                <li style="margin: 8px 0; padding: 8px; background: rgba(255,255,255,0.6); border-radius: 5px;">
                                    ${besoin}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; border: 2px solid var(--secondary);">
                        <h4 style="color: var(--secondary); margin-bottom: 15px;">‚úÖ Actions recommand√©es :</h4>
                        <ul style="margin-left: 20px;">
                            ${data.actions.map(action => `<li style="margin: 8px 0;">${action}</li>`).join('')}
                        </ul>
                    </div>
                </div>
            `;
        }
        
        function saveEmotionEntry() {
            const journal = document.getElementById('emotionJournal').value;
            if (!selectedEmotion || journal.trim() === '') {
                alert('S√©lectionne une √©motion et √©cris quelque chose !');
                return;
            }
            
            const entries = JSON.parse(localStorage.getItem('emotionEntries')) || [];
            const entry = {
                emotion: selectedEmotion,
                text: journal,
                date: new Date().toLocaleString('fr-FR'),
                timestamp: Date.now()
            };
            entries.unshift(entry);
            
            localStorage.setItem('emotionEntries', JSON.stringify(entries.slice(0, 50)));
            
            // Aussi sauvegarder pour les stats
            const emotionStats = JSON.parse(localStorage.getItem('emotionStats')) || [];
            emotionStats.push({
                emotion: selectedEmotion,
                timestamp: Date.now(),
                date: new Date().toISOString()
            });
            localStorage.setItem('emotionStats', JSON.stringify(emotionStats));
            
            document.getElementById('emotionJournal').value = '';
            loadJournalEntries();
            
            alert('‚úÖ Ton ressenti est enregistr√© !');
        }
        
        function loadJournalEntries() {
            const entries = JSON.parse(localStorage.getItem('emotionEntries')) || [];
            const container = document.getElementById('journalEntries');
            
            if (entries.length === 0) return;
            
            container.innerHTML = '<h3 style="margin-top: 30px;">üìö Mes derni√®res entr√©es</h3>';
            entries.forEach(entry => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'result-box';
                entryDiv.style.marginTop = '15px';
                entryDiv.innerHTML = `
                    <strong>${entry.emotion.charAt(0).toUpperCase() + entry.emotion.slice(1)} - ${entry.date}</strong>
                    <p style="margin-top: 10px;">${entry.text}</p>
                `;
                container.appendChild(entryDiv);
            });
        }

        // R√âSOLUTION DE PROBL√àME
        function solveProblem() {
            const before = document.getElementById('problemBefore').value;
            const behavior = document.getElementById('problemBehavior').value;
            const after = document.getElementById('problemAfter').value;
            const functionSelect = document.getElementById('problemFunction').value;
            const alternative = document.getElementById('problemAlternative').value;
            const firstStep = document.getElementById('problemFirstStep').value;
            
            if (!before || !behavior || !after || !functionSelect || !alternative || !firstStep) {
                alert('Remplis tous les champs pour faire ton analyse fonctionnelle !');
                return;
            }
            
            const functions = {
                escape: {
                    name: '√âviter/√âchapper',
                    icon: 'üèÉ',
                    explanation: 'Ton comportement sert √† √©viter quelque chose de d√©sagr√©able (stress, ennui, difficult√©). C\'est une strat√©gie d\'√©vitement.',
                    tips: [
                        'Identifie ce que tu √©vites exactement (l\'√©motion ? la difficult√© ? l\'√©chec potentiel ?)',
                        'Trouve des moyens plus adaptat√©s de g√©rer ce que tu √©vites',
                        'D√©coupe la t√¢che √©vit√©e en micro-√©tapes moins mena√ßantes',
                        'Utilise des techniques de r√©gulation √©motionnelle avant de commencer'
                    ]
                },
                attention: {
                    name: 'Obtenir de l\'attention',
                    icon: 'üëã',
                    explanation: 'Ton comportement attire l\'attention des autres, m√™me si c\'est n√©gatif. Tu as besoin d\'√™tre vu et reconnu.',
                    tips: [
                        'Trouve des moyens positifs d\'obtenir de l\'attention',
                        'Communique directement ton besoin d\'√™tre √©cout√©',
                        'Planifie des moments de qualit√© avec les autres',
                        'Demande explicitement ce dont tu as besoin'
                    ]
                },
                tangible: {
                    name: 'Obtenir quelque chose',
                    icon: 'üéÅ',
                    explanation: 'Ton comportement te permet d\'obtenir quelque chose que tu veux (activit√© plaisante, stimulation, dopamine).',
                    tips: [
                        'Utilise un syst√®me de r√©compenses structur√©',
                        'Planifie les activit√©s plaisantes APR√àS les t√¢ches',
                        'Trouve des alternatives qui te donnent satisfaction sans procrastiner',
                        'Cr√©e un √©quilibre entre effort et r√©compense'
                    ]
                },
                sensory: {
                    name: 'Stimulation sensorielle',
                    icon: '‚ö°',
                    explanation: 'Ton comportement r√©pond √† un besoin de stimulation sensorielle. Ton cerveau TDAH a besoin de bouger, toucher, stimuler.',
                    tips: [
                        'Int√®gre du mouvement dans ton travail (ballon, bureau debout, marche)',
                        'Utilise des fidgets pendant les t√¢ches',
                        'Pr√©vois des pauses actives toutes les 25 minutes',
                        'Accepte que ton corps a besoin de bouger pour te concentrer'
                    ]
                }
            };
            
            const selectedFunction = functions[functionSelect];
            
            const resultDiv = document.getElementById('problemResult');
            resultDiv.innerHTML = `
                <div class="result-box">
                    <h3>üìä Ton analyse fonctionnelle</h3>
                    
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <p><strong>üîç Situation :</strong> ${before}</p>
                        <p style="margin-top: 10px;"><strong>‚ö†Ô∏è Comportement :</strong> ${behavior}</p>
                        <p style="margin-top: 10px;"><strong>‚û°Ô∏è Cons√©quence :</strong> ${after}</p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; color: white; margin: 15px 0;">
                        <h4 style="margin-bottom: 10px;">${selectedFunction.icon} Fonction identifi√©e : ${selectedFunction.name}</h4>
                        <p>${selectedFunction.explanation}</p>
                    </div>
                    
                    <div style="background: white; padding: 15px; border-radius: 10px; margin: 15px 0; border: 2px solid var(--secondary);">
                        <h4 style="color: var(--secondary); margin-bottom: 10px;">üí° Strat√©gies recommand√©es :</h4>
                        <ul style="margin-left: 20px;">
                            ${selectedFunction.tips.map(tip => `<li style="margin: 8px 0;">${tip}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 10px; margin: 15px 0;">
                        <h4 style="color: var(--success); margin-bottom: 10px;">‚úÖ Comportement alternatif :</h4>
                        <p style="font-size: 1.1rem;">${alternative}</p>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%); padding: 20px; border-radius: 10px; color: var(--dark); margin-top: 15px;">
                        <h4 style="margin-bottom: 10px;">üöÄ PREMI√àRE ACTION MAINTENANT :</h4>
                        <p style="font-size: 1.2rem; font-weight: 600;">${firstStep}</p>
                    </div>
                    
                    <p style="margin-top: 15px; font-style: italic; color: #666;">
                        üí° Astuce : Le changement prend du temps. Observe les d√©clencheurs (AVANT), teste ton alternative progressivement, 
                        et ajuste jusqu'√† trouver ce qui marche POUR TOI. Sois patient et bienveillant avec toi-m√™me.
                    </p>
                </div>
            `;
            
            // Ajouter automatiquement comme t√¢che urgente
            const task = {
                id: Date.now(),
                text: firstStep,
                priority: 'urgent',
                completed: false,
                date: new Date().toLocaleDateString('fr-FR')
            };
            tasks.push(task);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            
            // Scroll vers le r√©sultat
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // TIMER POMODORO
        let timerInterval;
        let timeLeft = 1500; // 25 minutes en secondes
        let isRunning = false;
        
        function startTimer() {
            if (isRunning) return;
            isRunning = true;
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    isRunning = false;
                    alert('üéâ Bravo ! Session termin√©e ! Prends une pause de 5 minutes.');
                    playSound();
                }
            }, 1000);
        }
        
        function pauseTimer() {
            clearInterval(timerInterval);
            isRunning = false;
        }
        
        function resetTimer() {
            clearInterval(timerInterval);
            isRunning = false;
            const duration = document.getElementById('timerDuration').value;
            timeLeft = duration * 60;
            updateTimerDisplay();
        }
        
        function changeTimerDuration() {
            resetTimer();
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }
        
        function playSound() {
            // Simple beep avec Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            oscillator.type = 'sine';
            oscillator.frequency.value = 800;
            oscillator.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        // RECOMMANDATIONS SITUATIONNELLES
        function showSituation(situationType) {
            const situations = {
                procrastination: {
                    title: '‚è∞ Procrastination - Briser le cercle',
                    strategies: [
                        '<strong>La r√®gle des 2 minutes :</strong> Commence juste 2 minutes. Une fois lanc√©, c\'est plus facile de continuer.',
                        '<strong>D√©coupe ultra-fin :</strong> Si la t√¢che semble √©norme, d√©coupe-la en √©tapes de 5 minutes max.',
                        '<strong>Change de lieu :</strong> Va dans une autre pi√®ce, un caf√©, dehors. Parfois le lieu bloque.',
                        '<strong>R√©compense imm√©diate :</strong> Promets-toi quelque chose de plaisant JUSTE APR√àS (pas apr√®s tout, apr√®s la premi√®re √©tape).',
                        '<strong>Timer invers√© :</strong> "Je travaille jusqu\'√† 15h37" plut√¥t que "pendant 30 minutes" (bizarrement √ßa marche mieux).',
                        '<strong>Body double :</strong> Travaille √† c√¥t√© de quelqu\'un, m√™me en silence, m√™me en visio.'
                    ],
                    immediate: 'Choisis LA PLUS PETITE action possible et lance-toi maintenant, m√™me si c\'est juste ouvrir le fichier.'
                },
                submerg√©: {
                    title: 'üåä Submerg√© - Retrouver la surface',
                    strategies: [
                        '<strong>Brain dump total :</strong> √âcris TOUT ce qui te stresse sur papier, sans ordre, pendant 5 minutes.',
                        '<strong>Cat√©gorise apr√®s :</strong> Une fois tout sorti, regroupe par th√®mes (urgent/important/peut attendre/peut d√©l√©guer).',
                        '<strong>La r√®gle du 1 :</strong> Choisis UNE SEULE mini-t√¢che. Le reste n\'existe pas pour les 15 prochaines minutes.',
                        '<strong>Respiration 4-7-8 :</strong> Inspire 4s, retiens 7s, expire 8s. R√©p√®te 4 fois. √áa calme le syst√®me nerveux.',
                        '<strong>Accepte l\'imperfection :</strong> Fait > Parfait. Toujours.',
                        '<strong>Demande de l\'aide :</strong> D√©l√©guer n\'est pas √©chouer, c\'est √™tre intelligent.'
                    ],
                    immediate: 'Arr√™te tout. Respire. Fais une liste. Choisis UN truc. Juste un.'
                },
                distraction: {
                    title: 'üéØ Concentration impossible - Cr√©er une bulle',
                    strategies: [
                        '<strong>Mode avion total :</strong> T√©l√©phone en avion, notifications OFF partout, ferme TOUS les onglets sauf 1.',
                        '<strong>Musique sp√©cifique :</strong> Cr√©e UNE playlist "focus" et utilise toujours la m√™me (ton cerveau va l\'associer au travail).',
                        '<strong>Timer courts :</strong> 15 minutes de focus, puis 5 minutes de distraction autoris√©e. Alterne.',
                        '<strong>Change de sens :</strong> Si tu ne peux pas lire, essaie d\'√©couter. Si tu ne peux pas √©crire, dicte √† voix haute.',
                        '<strong>Accepte le mouvement :</strong> Ballon d\'assise, fidget, marche en r√©fl√©chissant. Bouge pendant que tu travailles.',
                        '<strong>Gamification :</strong> Transforme la t√¢che en jeu ou challenge avec timer.'
                    ],
                    immediate: '√âlimine UNE distraction maintenant. Juste une. Puis focus 10 minutes.'
                },
                hyperfocus: {
                    title: 'üî• Hyperfocus - Canaliser la puissance',
                    strategies: [
                        '<strong>Profite mais prot√®ge :</strong> C\'est un super-pouvoir ! Mais mets des alarmes pour boire/manger/bouger.',
                        '<strong>Capture tes id√©es :</strong> Note tout ce qui te vient sans quitter ta t√¢che (doc √† c√¥t√© ou vocal).',
                        '<strong>Timer de pause forc√©e :</strong> Toutes les 90 minutes MAX, l√®ve-toi 5 minutes (m√™me si tu ne veux pas).',
                        '<strong>Pr√©pare l\'environnement :</strong> Avant de plonger : eau, snacks, toilettes, t√©l√©phone loin.',
                        '<strong>Choisis tes combats :</strong> Garde l\'hyperfocus pour les t√¢ches importantes, pas pour scroller.',
                        '<strong>Pr√©viens ton entourage :</strong> Dis que tu seras indispo pendant X temps.'
                    ],
                    immediate: 'Mets un timer pour dans 60 minutes pour faire une pause. Vraiment.'
                },
                transitions: {
                    title: 'üîÑ Transitions difficiles - Adoucir les changements',
                    strategies: [
                        '<strong>Timer de pr√©venance :</strong> Mets une alarme 10 min AVANT de devoir changer d\'activit√©.',
                        '<strong>Rituel de transition :</strong> Cr√©e une mini-routine (ex: 3 grandes respirations + ranger son espace).',
                        '<strong>Pr√©pare le suivant :</strong> Avant de finir A, pose 1 √©l√©ment pour d√©marrer B (ouvre le doc, sors le mat√©riel).',
                        '<strong>Accepte le temps mort :</strong> Autorise-toi 5 minutes de "rien" entre deux t√¢ches.',
                        '<strong>Musique pont :</strong> Une chanson sp√©cifique pour marquer la transition.',
                        '<strong>Checklist visuelle :</strong> Coche visuellement "T√¢che A termin√©e" avant de passer √† B.'
                    ],
                    immediate: 'Termine ce que tu fais dans les 5 prochaines minutes, m√™me imparfaitement, puis fais une pause vraie de 5 min.'
                },
                matin: {
                    title: 'üåÖ D√©marrage difficile - Routine de lancement',
                    strategies: [
                        '<strong>Pr√©pare la veille :</strong> V√™tements sortis, petit-d√©j pr√©par√©, sac pr√™t. Ton toi du matin te remerciera.',
                        '<strong>Alarme progressive :</strong> Lumi√®re douce qui augmente + sons de nature plut√¥t qu\'alarme agressive.',
                        '<strong>Routine ultra-simple :</strong> 3-5 actions TOUJOURS dans le m√™me ordre (cerveau en pilote auto).',
                        '<strong>Pas de d√©cisions le matin :</strong> Tout doit √™tre d√©cid√© la veille (habits, petit-d√©j, premi√®re t√¢che).',
                        '<strong>Lumi√®re et mouvement :</strong> Ouvre fen√™tre + 5 √©tirements = signal "jour" pour ton cerveau.',
                        '<strong>Pas de t√©l√©phone avant :</strong> Termine ta routine AVANT de regarder ton tel (sinon tu y passes 1h).'
                    ],
                    immediate: 'Ce soir, pr√©pare TOUT pour demain matin. Litt√©ralement tout.'
                },
                soir: {
                    title: 'üåô Coucher difficile - Rituel d\'atterrissage',
                    strategies: [
                        '<strong>Heure fixe non-n√©gociable :</strong> M√™me heure de coucher 7j/7. Ton cerveau a besoin de routine.',
                        '<strong>Routine de "descente" :</strong> Commence 1h avant : lumi√®res basses, activit√©s calmes, temp√©rature fra√Æche.',
                        '<strong>Brain dump du soir :</strong> Vide toutes tes pens√©es/to-do de demain sur papier. Lib√®re ton cerveau.',
                        '<strong>Z√©ro √©cran 30 min avant :</strong> Vraiment. La lumi√®re bleue d√©truit ton endormissement.',
                        '<strong>Activit√© ennuyeuse :</strong> Lis quelque chose de chiant, √©coute un podcast monotone.',
                        '<strong>Accepte le temps :</strong> S\'endormir prend du temps, c\'est normal. Ne stresse pas.'
                    ],
                    immediate: '√âteins tous les √©crans MAINTENANT et fais ton brain dump sur papier.'
                },
                social: {
                    title: 'üë• Situations sociales - Naviguer les interactions',
                    strategies: [
                        '<strong>Pr√©pare des scripts :</strong> Phrases toutes faites pour small talk ("Et toi, √ßa va ?", "Int√©ressant !").',
                        '<strong>Pauses strat√©giques :</strong> Va aux toilettes pour respirer et recharger en √©nergie sociale.',
                        '<strong>Limite temporelle :</strong> "Je peux rester jusqu\'√† 20h" (√ßa diminue l\'anxi√©t√©).',
                        '<strong>Trouve ton r√¥le :</strong> Aide en cuisine, sers √† boire... Avoir une fonction aide √† g√©rer l\'interaction.',
                        '<strong>Ami ancre :</strong> Va avec quelqu\'un que tu connais bien qui te s√©curise.',
                        '<strong>Apr√®s-social :</strong> Pr√©vois du temps seul apr√®s pour te ressourcer.'
                    ],
                    immediate: 'Si c\'est trop : excuse-toi 5 min, va respirer dehors ou aux toilettes. Reviens si tu peux.'
                },
                decisions: {
                    title: 'ü§î Paralysie d√©cisionnelle - Sortir du blocage',
                    strategies: [
                        '<strong>Limite les options :</strong> Max 3 choix. Plus = paralysie.',
                        '<strong>Timer d√©cision :</strong> 5 minutes pour d√©cider, puis tu DOIS choisir.',
                        '<strong>Pile ou face :</strong> Lance une pi√®ce. Si tu es d√©√ßu du r√©sultat, tu sais ce que tu veux vraiment.',
                        '<strong>Et si je me trompe ?</strong> La plupart des d√©cisions sont r√©versibles. Commence, ajuste ensuite.',
                        '<strong>D√©l√®gue :</strong> Demande √† quelqu\'un de confiance de choisir pour toi.',
                        '<strong>Co√ªt d\'opportunit√© :</strong> Ne pas d√©cider est aussi une d√©cision (souvent la pire).'
                    ],
                    immediate: 'Choisis maintenant. S√©rieusement. Lance un d√© si n√©cessaire. GO.'
                },
                rejection: {
                    title: 'üíî Sensibilit√© au rejet - Adoucir la blessure',
                    strategies: [
                        '<strong>RSD est r√©el :</strong> Rejection Sensitive Dysphoria touche 99% des TDAH. Tu n\'es pas "trop sensible".',
                        '<strong>Pause avant r√©action :</strong> Attends 24h avant de r√©pondre quand tu te sens rejet√©.',
                        '<strong>Questionne l\'interpr√©tation :</strong> "Est-ce vraiment un rejet ou je surinterpr√®te ?"',
                        '<strong>Parle-en :</strong> "J\'ai senti que... est-ce que j\'interpr√®te mal ?" (souvent tu interpr√®tes mal).',
                        '<strong>Liste des preuves d\'amour :</strong> Garde une note avec des messages gentils re√ßus, √† relire en cas de RSD.',
                        '<strong>Auto-compassion :</strong> Parle-toi comme √† ton meilleur ami. Avec douceur.'
                    ],
                    immediate: 'Respire. C\'est probablement ton cerveau TDAH qui exag√®re. Attends demain pour analyser.'
                },
                impulsivit√©: {
                    title: '‚ö° Impulsivit√© - Cr√©er un espace de r√©flexion',
                    strategies: [
                        '<strong>R√®gle des 24h :</strong> Achats/d√©cisions importantes = attendre 24h minimum.',
                        '<strong>Budget impulsivit√© :</strong> Autorise-toi X‚Ç¨/mois pour les achats impulsifs (limite les d√©g√¢ts).',
                        '<strong>Liste de souhaits :</strong> Note l\'envie au lieu d\'acheter. Revois la liste dans 1 semaine.',
                        '<strong>Pause physique :</strong> Avant d\'agir, fais 10 squats ou sors 2 minutes. √áa calme l\'impulsion.',
                        '<strong>Appel d\'un ami :</strong> "Je veux faire X, parle-moi 5 minutes" (souvent l\'impulsion passe).',
                        '<strong>Canaux d\'√©nergie :</strong> Redirige l\'√©nergie vers du sport, de l\'art, quelque chose de productif.'
                    ],
                    immediate: 'Attends 10 minutes. Mets un timer. Si tu veux toujours apr√®s, ok.'
                },
                ennui: {
                    title: 'üòë Ennui intense - Nourrir le cerveau TDAH',
                    strategies: [
                        '<strong>Accepte-le :</strong> L\'ennui est PHYSIQUEMENT douloureux pour un cerveau TDAH. Ce n\'est pas de la faiblesse.',
                        '<strong>Stimulation douce :</strong> Fidget, musique, gomme √† m√¢cher pendant les t√¢ches ennuyeuses.',
                        '<strong>Gamifie :</strong> Transforme tout en jeu/challenge avec timer et r√©compenses.',
                        '<strong>Body double :</strong> Travailler "avec" quelqu\'un (m√™me en silence) rend moins ennuyeux.',
                        '<strong>Alterne :</strong> 15 min t√¢che chiante, 5 min t√¢che fun. Alterne.',
                        '<strong>Nouveaut√© :</strong> Change de lieu, de m√©thode, d\'outil. La nouveaut√© stimule le TDAH.'
                    ],
                    immediate: 'Mets de la musique, prends un fidget, et lance un timer de 15 minutes. Tu peux tout supporter 15 minutes.'
                }
            };
            
            const situationData = situations[situationType];
            const resultDiv = document.getElementById('situationResult');
            
            resultDiv.innerHTML = `
                <div class="result-box" style="margin-top: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">${situationData.title}</h3>
                    
                    <div style="background: white; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <h4 style="color: var(--secondary); margin-bottom: 15px;">üìã Strat√©gies √† tester :</h4>
                        <ul style="list-style: none; padding: 0;">
                            ${situationData.strategies.map(strategy => `
                                <li style="margin: 15px 0; padding: 10px; background: #f8f9fa; border-radius: 8px;">
                                    ${strategy}
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    
                    <div style="background: linear-gradient(135deg, var(--accent) 0%, var(--warning) 100%); padding: 20px; border-radius: 10px; color: var(--dark);">
                        <h4 style="margin-bottom: 10px;">‚ö° ACTION IMM√âDIATE :</h4>
                        <p style="font-size: 1.1rem; font-weight: 500;">${situationData.immediate}</p>
                    </div>
                </div>
            `;
            
            // Scroll vers le r√©sultat
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // SUGGESTIONS SELON L'√âNERGIE
        function suggestByEnergy(level) {
            const suggestions = {
                high: {
                    title: 'üöÄ Haute √©nergie - Fonce !',
                    tasks: [
                        'T√¢ches complexes qui demandent de la r√©flexion',
                        'Apprentissage de nouvelles comp√©tences',
                        'Projets cr√©atifs ambitieux',
                        'T√¢ches physiques ou sportives',
                        'Conversations importantes ou difficiles',
                        'R√©solution de probl√®mes compliqu√©s'
                    ]
                },
                medium: {
                    title: '‚ö° √ânergie moyenne - √âquilibre',
                    tasks: [
                        'T√¢ches de routine bien √©tablies',
                        'R√©pondre aux emails',
                        'Organiser et planifier',
                        'T√¢ches m√©nag√®res l√©g√®res',
                        'Lecture ou apprentissage l√©ger',
                        'Appels t√©l√©phoniques standards'
                    ]
                },
                low: {
                    title: 'üîã Basse √©nergie - Douceur',
                    tasks: [
                        'T√¢ches automatiques et simples',
                        'Ranger/trier (sans pression)',
                        '√âcouter des podcasts ou vid√©os √©ducatives',
                        'Faire des listes pour plus tard',
                        'M√©ditation ou √©tirements doux',
                        'Te reposer SANS CULPABILIT√â !'
                    ]
                }
            };
            
            const suggestion = suggestions[level];
            const resultDiv = document.getElementById('energySuggestions');
            
            resultDiv.innerHTML = `
                <div class="result-box">
                    <h3>${suggestion.title}</h3>
                    <p><strong>T√¢ches recommand√©es :</strong></p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        ${suggestion.tasks.map(task => `<li style="margin: 8px 0;">${task}</li>`).join('')}
                    </ul>
                </div>
            `;
        }

        // STATISTIQUES ET GRAPHIQUES
        let emotionsChart = null;
        let tasksChart = null;
        let currentPeriod = 'today';

        function changeStatsPeriod(period) {
            currentPeriod = period;
            
            // Mettre √† jour les boutons
            document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById('btn-' + period).classList.add('active');
            
            // Mettre √† jour le label
            const labels = {
                today: "aujourd'hui",
                week: "cette semaine",
                month: "ce mois"
            };
            document.getElementById('periodLabel').textContent = labels[period];
            
            // Mettre √† jour les graphiques
            updateStatsCharts();
        }

        function updateStatsCharts() {
            updateEmotionsChart();
            updateTasksChart();
            updateSummaryStats();
        }

        function getDateRange(period) {
            const now = Date.now();
            let startDate;
            
            if (period === 'today') {
                const today = new Date();
                today.setHours(0, 0, 0, 0);
                startDate = today.getTime();
            } else if (period === 'week') {
                startDate = now - (7 * 24 * 60 * 60 * 1000);
            } else {
                startDate = now - (30 * 24 * 60 * 60 * 1000);
            }
            
            return { startDate, endDate: now };
        }

        function updateEmotionsChart() {
            const emotionStats = JSON.parse(localStorage.getItem('emotionStats')) || [];
            const { startDate, endDate } = getDateRange(currentPeriod);
            
            // Filtrer par p√©riode
            const filteredEmotions = emotionStats.filter(e => 
                e.timestamp >= startDate && e.timestamp <= endDate
            );
            
            // Compter les √©motions
            const emotionCounts = {};
            filteredEmotions.forEach(e => {
                emotionCounts[e.emotion] = (emotionCounts[e.emotion] || 0) + 1;
            });
            
            // Si on regarde aujourd'hui, grouper par heure
            let chartData;
            if (currentPeriod === 'today') {
                chartData = getEmotionsByHour(filteredEmotions);
            } else {
                chartData = {
                    labels: Object.keys(emotionCounts),
                    data: Object.values(emotionCounts)
                };
            }
            
            const ctx = document.getElementById('emotionsChart');
            
            // D√©truire l'ancien graphique s'il existe
            if (emotionsChart) {
                emotionsChart.destroy();
            }
            
            const emotionColors = {
                joyeux: '#FFE66D',
                calme: '#4ECDC4',
                anxieux: '#FF6B6B',
                frustr√©: '#FFB84D',
                triste: '#95E1D3',
                d√©bord√©: '#F38181',
                excit√©: '#AA96DA',
                fatigu√©: '#C7CEEA'
            };
            
            emotionsChart = new Chart(ctx, {
                type: currentPeriod === 'today' ? 'line' : 'bar',
                data: {
                    labels: chartData.labels,
                    datasets: currentPeriod === 'today' ? 
                        Object.keys(chartData.datasets).map(emotion => ({
                            label: emotion.charAt(0).toUpperCase() + emotion.slice(1),
                            data: chartData.datasets[emotion],
                            borderColor: emotionColors[emotion] || '#999',
                            backgroundColor: (emotionColors[emotion] || '#999') + '40',
                            tension: 0.4,
                            fill: true
                        })) :
                        [{
                            label: 'Nombre de fois',
                            data: chartData.data,
                            backgroundColor: chartData.labels.map(label => emotionColors[label] || '#999')
                        }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: currentPeriod === 'today'
                        },
                        title: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function getEmotionsByHour(emotions) {
            const hours = Array.from({length: 24}, (_, i) => i + 'h');
            const datasets = {};
            
            emotions.forEach(e => {
                const date = new Date(e.timestamp);
                const hour = date.getHours();
                
                if (!datasets[e.emotion]) {
                    datasets[e.emotion] = new Array(24).fill(0);
                }
                datasets[e.emotion][hour]++;
            });
            
            return { labels: hours, datasets };
        }

        function updateTasksChart() {
            const { startDate, endDate } = getDateRange(currentPeriod);
            
            // Filtrer les t√¢ches par p√©riode
            const filteredTasks = tasks.filter(t => {
                const taskDate = new Date(t.date.split('/').reverse().join('-')).getTime();
                return taskDate >= startDate && taskDate <= endDate;
            });
            
            const completed = filteredTasks.filter(t => t.completed).length;
            const pending = filteredTasks.length - completed;
            
            const ctx = document.getElementById('tasksChart');
            
            if (tasksChart) {
                tasksChart.destroy();
            }
            
            tasksChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Compl√©t√©es', 'En cours'],
                    datasets: [{
                        data: [completed, pending],
                        backgroundColor: ['#51CF66', '#FFB84D'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateSummaryStats() {
            const { startDate, endDate } = getDateRange(currentPeriod);
            const emotionStats = JSON.parse(localStorage.getItem('emotionStats')) || [];
            
            // T√¢ches compl√©t√©es
            const filteredTasks = tasks.filter(t => {
                const taskDate = new Date(t.date.split('/').reverse().join('-')).getTime();
                return t.completed && taskDate >= startDate && taskDate <= endDate;
            });
            document.getElementById('totalTasksCompleted').textContent = filteredTasks.length;
            
            // √âmotion dominante
            const filteredEmotions = emotionStats.filter(e => 
                e.timestamp >= startDate && e.timestamp <= endDate
            );
            
            const emotionCounts = {};
            filteredEmotions.forEach(e => {
                emotionCounts[e.emotion] = (emotionCounts[e.emotion] || 0) + 1;
            });
            
            if (Object.keys(emotionCounts).length > 0) {
                const mostFrequent = Object.entries(emotionCounts)
                    .sort((a, b) => b[1] - a[1])[0];
                
                const emotionEmojis = {
                    joyeux: 'üòä',
                    calme: 'üòå',
                    anxieux: 'üò∞',
                    frustr√©: 'üò§',
                    triste: 'üò¢',
                    d√©bord√©: 'ü§Ø',
                    excit√©: 'ü§©',
                    fatigu√©: 'üò¥'
                };
                
                document.getElementById('emotionMostFrequent').textContent = 
                    emotionEmojis[mostFrequent[0]] + ' ' + mostFrequent[0].charAt(0).toUpperCase() + mostFrequent[0].slice(1);
            } else {
                document.getElementById('emotionMostFrequent').textContent = '-';
            }
        }

        // POINTS D'√âTAPE (MILESTONES)
        function addMilestone() {
            const text = prompt('D√©cris ton point d\'√©tape ou ton objectif :');
            if (!text || text.trim() === '') return;
            
            const milestones = JSON.parse(localStorage.getItem('milestones')) || [];
            milestones.push({
                id: Date.now(),
                text: text,
                date: new Date().toLocaleString('fr-FR'),
                completed: false
            });
            
            localStorage.setItem('milestones', JSON.stringify(milestones));
            loadMilestones();
        }

        function loadMilestones() {
            const milestones = JSON.parse(localStorage.getItem('milestones')) || [];
            const container = document.getElementById('milestonesList');
            
            if (milestones.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999;">Aucun point d\'√©tape pour le moment. Ajoute-en un !</p>';
                return;
            }
            
            container.innerHTML = milestones.map(m => `
                <div class="milestone-item ${m.completed ? 'completed' : ''}">
                    <div style="flex: 1;">
                        <input type="checkbox" ${m.completed ? 'checked' : ''} 
                               onchange="toggleMilestone(${m.id})" 
                               style="margin-right: 10px; width: 20px; height: 20px; cursor: pointer;">
                        <strong>${m.text}</strong>
                        <div class="milestone-date">${m.date}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteMilestone(${m.id})">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function toggleMilestone(id) {
            const milestones = JSON.parse(localStorage.getItem('milestones')) || [];
            const milestone = milestones.find(m => m.id === id);
            if (milestone) {
                milestone.completed = !milestone.completed;
                localStorage.setItem('milestones', JSON.stringify(milestones));
                loadMilestones();
            }
        }

        function deleteMilestone(id) {
            if (!confirm('Supprimer ce point d\'√©tape ?')) return;
            let milestones = JSON.parse(localStorage.getItem('milestones')) || [];
            milestones = milestones.filter(m => m.id !== id);
            localStorage.setItem('milestones', JSON.stringify(milestones));
            loadMilestones();
        }

        // FONCTIONS DU S√âQUENTIEL
        let sequentialSteps = [];
        let stepCounter = 0;

        function addSequentialStep() {
            stepCounter++;
            const stepId = 'step-' + stepCounter;
            
            const stepData = {
                id: stepId,
                text: '',
                image: null,
                imageData: null
            };
            
            sequentialSteps.push(stepData);
            renderSequentialSteps();
        }

        function renderSequentialSteps() {
            const container = document.getElementById('sequentialSteps');
            
            if (sequentialSteps.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #999; padding: 40px;">Aucune √©tape pour le moment. Clique sur "Ajouter une √©tape" pour commencer !</p>';
                return;
            }
            
            container.innerHTML = sequentialSteps.map((step, index) => `
                <div style="background: #F8F9FA; padding: 20px; border-radius: 15px; border: 2px solid #E0E0E0;">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                        <div style="background: #FF6B6B; color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.2rem; flex-shrink: 0;">
                            ${index + 1}
                        </div>
                        <input type="text" 
                               placeholder="D√©cris cette √©tape (ex: Me laver les mains)" 
                               value="${step.text}"
                               onchange="updateStepText('${step.id}', this.value)"
                               style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem; font-family: 'Poppins', sans-serif;">
                        <div style="display: flex; gap: 8px; flex-shrink: 0;">
                            ${index > 0 ? `<button onclick="moveStep(${index}, -1)" style="width: 40px; height: 40px; background: #4ECDC4; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.2rem;">‚Üë</button>` : ''}
                            ${index < sequentialSteps.length - 1 ? `<button onclick="moveStep(${index}, 1)" style="width: 40px; height: 40px; background: #4ECDC4; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.2rem;">‚Üì</button>` : ''}
                            <button onclick="deleteStep('${step.id}')" style="width: 40px; height: 40px; background: #FF6B6B; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.2rem;">üóë</button>
                        </div>
                    </div>
                    <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                        <label for="image-${step.id}" style="padding: 10px 20px; background: #51CF66; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            üì∑ ${step.imageData ? 'Changer l\'image' : 'Ajouter une image'}
                            <input type="file" id="image-${step.id}" accept="image/*" onchange="uploadStepImage('${step.id}', this)" style="display: none;">
                        </label>
                        ${step.imageData ? `
                            <div style="position: relative; display: inline-block;">
                                <img src="${step.imageData}" style="height: 80px; border-radius: 8px; border: 2px solid #51CF66;">
                                <button onclick="removeStepImage('${step.id}')" style="position: absolute; top: -8px; right: -8px; width: 24px; height: 24px; background: #FF6B6B; color: white; border: none; border-radius: 50%; cursor: pointer; font-size: 0.8rem;">‚úï</button>
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        function updateStepText(stepId, text) {
            const step = sequentialSteps.find(s => s.id === stepId);
            if (step) step.text = text;
        }

        async function uploadStepImage(stepId, input) {
            const file = input.files[0];
            if (!file) return;
            
            const step = sequentialSteps.find(s => s.id === stepId);
            if (!step) return;
            
            try {
                // Afficher un message de chargement
                showSequentialMessage('‚è≥ Upload de l\'image en cours...', 'info');
                
                // Cr√©er FormData pour l'API Dropl
                const formData = new FormData();
                formData.append('file', file);
                
                // Envoyer √† l'API Dropl
                const response = await fetch('https://api.dropl.fr/upload', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error('Erreur upload');
                }
                
                const data = await response.json();
                
                // Convertir l'image en base64 pour l'affichage et le PDF
                const reader = new FileReader();
                reader.onload = function(e) {
                    step.imageData = e.target.result;
                    step.image = data.url || data.file_url || e.target.result;
                    renderSequentialSteps();
                    showSequentialMessage('‚úÖ Image ajout√©e !', 'success');
                };
                reader.readAsDataURL(file);
                
            } catch (error) {
                console.error('Erreur:', error);
                // En cas d'√©chec de l'API, on utilise quand m√™me l'image locale
                const reader = new FileReader();
                reader.onload = function(e) {
                    step.imageData = e.target.result;
                    step.image = e.target.result;
                    renderSequentialSteps();
                    showSequentialMessage('‚úÖ Image ajout√©e !', 'success');
                };
                reader.readAsDataURL(file);
            }
        }

        function removeStepImage(stepId) {
            const step = sequentialSteps.find(s => s.id === stepId);
            if (step) {
                step.image = null;
                step.imageData = null;
                renderSequentialSteps();
            }
        }

        function moveStep(index, direction) {
            const newIndex = index + direction;
            if (newIndex < 0 || newIndex >= sequentialSteps.length) return;
            
            const temp = sequentialSteps[index];
            sequentialSteps[index] = sequentialSteps[newIndex];
            sequentialSteps[newIndex] = temp;
            
            renderSequentialSteps();
        }

        function deleteStep(stepId) {
            if (confirm('Supprimer cette √©tape ?')) {
                sequentialSteps = sequentialSteps.filter(s => s.id !== stepId);
                renderSequentialSteps();
            }
        }

        function clearSequential() {
            if (confirm('Effacer tout le s√©quentiel ?')) {
                sequentialSteps = [];
                stepCounter = 0;
                document.getElementById('sequentialTitle').value = '';
                renderSequentialSteps();
                showSequentialMessage('üóëÔ∏è S√©quentiel effac√©', 'info');
            }
        }

        function showSequentialMessage(message, type) {
            const msgDiv = document.getElementById('sequentialMessage');
            msgDiv.textContent = message;
            msgDiv.style.display = 'block';
            
            if (type === 'info') {
                msgDiv.style.background = '#D1ECF1';
                msgDiv.style.borderColor = '#17A2B8';
                msgDiv.style.color = '#0C5460';
            } else if (type === 'success') {
                msgDiv.style.background = '#D4EDDA';
                msgDiv.style.borderColor = '#28A745';
                msgDiv.style.color = '#155724';
            }
            
            setTimeout(() => {
                msgDiv.style.display = 'none';
            }, 3000);
        }

        async function generateSequentialPDF() {
            const title = document.getElementById('sequentialTitle').value.trim();
            
            if (!title) {
                alert('‚ö†Ô∏è Donne un titre √† ton s√©quentiel !');
                return;
            }
            
            if (sequentialSteps.length === 0) {
                alert('‚ö†Ô∏è Ajoute au moins une √©tape !');
                return;
            }
            
            showSequentialMessage('‚è≥ G√©n√©ration du PDF en cours...', 'info');
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // Titre
                doc.setFontSize(24);
                doc.setFont(undefined, 'bold');
                doc.text(title, 105, 20, { align: 'center' });
                
                // Ligne de s√©paration
                doc.setLineWidth(0.5);
                doc.line(20, 25, 190, 25);
                
                let yPosition = 40;
                const pageHeight = 280;
                const stepHeight = 60;
                
                for (let i = 0; i < sequentialSteps.length; i++) {
                    const step = sequentialSteps[i];
                    
                    // Nouvelle page si n√©cessaire
                    if (yPosition + stepHeight > pageHeight) {
                        doc.addPage();
                        yPosition = 20;
                    }
                    
                    // Num√©ro de l'√©tape (cercle)
                    doc.setFillColor(255, 107, 107);
                    doc.circle(25, yPosition, 8, 'F');
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'bold');
                    doc.text(String(i + 1), 25, yPosition + 4, { align: 'center' });
                    
                    // Texte de l'√©tape
                    doc.setTextColor(0, 0, 0);
                    doc.setFontSize(14);
                    doc.setFont(undefined, 'normal');
                    const stepText = step.text || '√âtape sans description';
                    doc.text(stepText, 40, yPosition + 4, { maxWidth: 100 });
                    
                    // Image si pr√©sente
                    if (step.imageData) {
                        try {
                            doc.addImage(step.imageData, 'JPEG', 150, yPosition - 15, 40, 40);
                        } catch (e) {
                            console.error('Erreur ajout image:', e);
                        }
                    }
                    
                    // Ligne de s√©paration
                    doc.setDrawColor(200, 200, 200);
                    doc.line(20, yPosition + 25, 190, yPosition + 25);
                    
                    yPosition += stepHeight;
                }
                
                // Pied de page
                const today = new Date().toLocaleDateString('fr-FR');
                doc.setFontSize(10);
                doc.setTextColor(150, 150, 150);
                doc.text(`Cr√©√© le ${today} avec Mon Assistant TDAH - SESSAD Petit Prince`, 105, 290, { align: 'center' });
                
                // T√©l√©charger le PDF
                const filename = title.toLowerCase().replace(/\s+/g, '-') + '.pdf';
                doc.save(filename);
                
                showSequentialMessage('‚úÖ PDF g√©n√©r√© avec succ√®s !', 'success');
                
            } catch (error) {
                console.error('Erreur g√©n√©ration PDF:', error);
                alert('‚ùå Erreur lors de la g√©n√©ration du PDF. V√©rifie que toutes les images sont bien charg√©es.');
            }
        }

        // Chargement initial
        loadTasks();
    </script>
</body>
</html>